@using Microsoft.AspNetCore.Components

<div class="table-block-viewer">
    @if (!string.IsNullOrEmpty(Block.Title))
    {
        <h4 class="block-title">@Block.Title</h4>
    }
    
    @if (Block.Content != null && HasTableData())
    {
        <div class="table-responsive">
            <table class="table table-bordered">
                @if (HasHeaders())
                {
                    <thead>
                        <tr>
                            @foreach (var header in GetTableHeaders())
                            {
                                <th>@header</th>
                            }
                        </tr>
                    </thead>
                }
                <tbody>
                    @foreach (var row in GetTableData())
                    {
                        <tr>
                            @foreach (var cell in row)
                            {
                                <td>@cell</td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            Aucune donnée de tableau disponible.
        </div>
    }
</div>

@code {
    [Parameter]
    public CourBuilder.CoursBlock Block { get; set; } = default!;

    [Parameter]
    public bool IsReadOnly { get; set; } = true;

    private bool HasTableData()
    {
        if (Block.Content is TableBlock.TableBlockContent tableContent)
        {
            return tableContent.TableCells != null && tableContent.TableCells.Count > 0;
        }
        return false;
    }

    private bool HasHeaders()
    {
        if (Block.Content is TableBlock.TableBlockContent tableContent)
        {
            return tableContent.HasHeader && tableContent.HeaderCells != null && tableContent.HeaderCells.Count > 0;
        }
        return false;
    }

    private List<string> GetTableHeaders()
    {
        if (Block.Content is TableBlock.TableBlockContent tableContent && tableContent.HeaderCells != null)
        {
            return tableContent.HeaderCells;
        }
        return new List<string>();
    }

    private List<List<string>> GetTableData()
    {
        if (Block.Content is TableBlock.TableBlockContent tableContent && tableContent.TableCells != null)
        {
            return tableContent.TableCells;
        }
        return new List<List<string>>();
    }
}
